<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>重信风控</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <script src="js/common.js"></script>
    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/personal.css">
</head>
<body style="background: #F7F7F7">
<div class="personal-box">
    <div class="header orange">
        <a class="back" href=""></a>
        <div class="default-pic">
            <a href="picture.html"><img class="portrait" src="images/protrait.png" alt=""></a>
        </div>
        <div class="default-btns">
            <a class="login" href="">登录</a>
            <a class="signup" href="">注册</a>
        </div>
        <div class="dl">
            <a href="" class="rz">已认证</a>
            <p class="phone-num">18521759829</p>
        </div>
        <div class="money-box">
            <div>
                <p>余额(元)</p>
                <p class="money">0</p>
            </div>
            <div class="recharge">充值</div>
        </div>
    </div>
    <div class="module-p">
        <div class="module">
            <div class="line">
                <span class="xiaolu"></span>
                <p>消费记录</p>
                <a href=""></a>
            </div>
            <div class="line">
                <span class="chonglu"></span>
                <p>充值记录</p>
                <a href=""></a>
            </div>
        </div>
        <div class="module">
            <div class="line">
                <span class="liandian"></span>
                <p>联系我们</p>
                <a href=""></a>
            </div>
            <div class="line">
                <span class="about"></span>
                <p>关于我们</p>
                <a href=""></a>
            </div>
        </div>
        <div class="module">
            <div class="line">
                <span class="zizhi"></span>
                <p>资质认证</p>
                <a href=""></a>
            </div>
            <div class="line">
                <span class="shezhi"></span>
                <p>账号设置</p>
                <a href=""></a>
            </div>
        </div>
    </div>

    <button class="exit" type="button">退出登录</button>

    <footer>
        <ul>
            <li class="cs"><a href="index.html"><img src="images/home2.png" class="img1"/></a> <p>首页</p></li>
            <li><a href="查询.html"><img src="images/sousuo 2.png" class="img2"/></a> <p>查询</p></li>
            <li><a href="查询记录.html"><img src="images/jilu.png" class="img3"/> </a><p>查询记录</p></li>
            <li><a href="我的.html"><img src="images/geren.png" class="img4"/> </a><p>我的</p></li>
        </ul>
    </footer>

    <div class="picture-box">
        <div class="img-head">
            <a class="left img-back" href=""></a>
            <a class="right img-sure" href="">使用</a>
        </div>
        <img class="show-img" src="images/minpian.png" alt="">

    </div>

</div>
</body>
<script src="js/jquery-1.11.3.js"></script>
<script src="js/exif.js"></script>
<script>
    $(".portrait")
    /*$("#file").on("change",function(){
        var file=this.files[0];
        var url=window.URL.createObjectURL(this.files[0]);
        console.log(url);
        $(".picture-box").show();
        $(".show-img").attr("src",url);
    })*/




//    更换头像
  /*  $(".orange").on("click",".portrait",function(){
        $('#file').replaceWith('<input id="file" runat="server" type="file" accept="image/!*" style="width:100%; display:none" />');
        $("#file").click();
        $("#file").off("change").on("change",function(){
            var file = this.files[0];  //文件对象
            var url=window.URL.createObjectURL(this.files[0]);
            $(".portrait").attr("src",url);
        })
    });*/
/*var   Orientation;
//显示选择图片
$("#file").on("change",function(){
    var url;
    $(this).siblings('.tx').css('display','inline-block');
    $(this).siblings('.portrait').remove();
    var Cnv =$(this).siblings('canvas')[0];
    var Cntx = Cnv.getContext('2d');//获取2d编辑容器
    var imgss =   new Image();
    var agoimg= $(this).siblings('.tx')[0];
    var tmpFile = this.files[0];
    var reader = new FileReader();
    EXIF.getData(tmpFile, function() {
        // alert(EXIF.pretty(this));
        EXIF.getAllTags(this);
        //alert(EXIF.getTag(this, 'Orientation'));
        Orientation = EXIF.getTag(this, 'Orientation');
    });
    //return;
    reader.readAsDataURL(tmpFile);
    reader.onload = function (e) {
        url = e.target.result;
        imgss.src = url;
        agoimg.src=url;
        imgss.onload = function () {
//等比缩放
            var m = imgss.width / imgss.height;
            Cnv.width =300;//该值影响缩放后图片的大小
            Cnv.width= 300/m ;
//img放入画布中
//设置起始坐标，结束坐标

            Cntx.drawImage(agoimg, 0, 0,300,300/m);
            /!*ajax*!/
            var formData = new FormData();
            formData.append('file',returnBold('file'));



            //修复ios
            if (navigator.userAgent.match(/iphone/i)) {

                //alert(expectWidth + ',' + expectHeight);
                //如果方向角不为1，都需要进行旋转 added by lzk
                if(Orientation != "" && Orientation != 1){

                    switch(Orientation){
                        case 6://需要顺时针（向左）90度旋转

                            rotateImg(this,'left',Cnv);
                            break;
                        case 8://需要逆时针（向右）90度旋转

                            rotateImg(this,'right',Cnv);
                            break;
                        case 3://需要180度旋转

                            rotateImg(this,'right',Cnv);//转两次
                            rotateImg(this,'right',Cnv);
                            break;
                    }
                }

//img放入画布中
//设置起始坐标，结束坐标

            }


        }
    };
})
/!*Blob兼容写法*!/
function getBlob(buffer, format) {
    try {
        return new Blob(buffer, {type: format});
    } catch (e) {
        var bb = new (window.BlobBuilder || window.WebKitBlobBuilder || window.MSBlobBuilder);
        buffer.forEach(function(buf) {
            bb.append(buf);
        });
        return bb.getBlob(format);
    }
}
/!*返回blob 对象*!/
function  returnBold(id) {
    var Pic = $(document.getElementById(id)).siblings('canvas')[0].toDataURL("image/png");

    var text = window.atob(Pic.split(",")[1]);
    var buffer = new Uint8Array(text.length);
    for (var i = 0; i < text.length; i++) {
        buffer[i] = text.charCodeAt(i);
    }
    var type= document.getElementById(id).files.type;
    var blob = getBlob([buffer], type);
    return blob
}
/!*旋转图像*!/
function rotateImg(img, direction,canvas) {
    //alert(img);
    //最小与最大旋转方向，图片旋转4次后回到原方向
    var min_step = 0;
    var max_step = 3;
    //var img = document.getElementById(pid);
    if (img == null)return;
    //img的高度和宽度不能在img元素隐藏后获取，否则会出错
    var m = img.width / img.height;
    var height = 300;
    var width = 300*m;
    //var step = img.getAttribute('step');
    var step = 2;
    if (step == null) {
        step = min_step;
    }
    if (direction == 'right') {
        step++;
        //旋转到原位置，即超过最大值
        step > max_step && (step = min_step);
    } else {
        step--;
        step < min_step && (step = max_step);
    }
    //img.setAttribute('step', step);
    /!*var canvas = document.getElementById('pic_' + pid);
     if (canvas == null) {
     img.style.display = 'none';
     canvas = document.createElement('canvas');
     canvas.setAttribute('id', 'pic_' + pid);
     img.parentNode.appendChild(canvas);
     }  *!/
    //旋转角度以弧度值为参数
    var degree = step * 90 * Math.PI / 180;
    var ctx = canvas.getContext('2d');
    switch (step) {
        case 0:
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0);
            break;
        case 1:
            canvas.width = height;
            canvas.height = width;
            ctx.rotate(degree);
            ctx.drawImage(img, 0, -height,width,height);
            break;
        case 2:
            canvas.width = width;
            canvas.height = height;
            ctx.rotate(degree);
            ctx.drawImage(img, -width, -height,width,height);
            break;
        case 3:
            canvas.width = height;
            canvas.height = width;
            ctx.rotate(degree);
            ctx.drawImage(img, -width, 0,width,height);
            break;
    }
}*/




</script>
</html>